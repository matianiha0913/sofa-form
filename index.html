<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Matiani | Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´</title>
<style>
body { font-family: Tahoma,sans-serif; background:#fff; color:#000; margin:0; padding:0; }
h1,h2,h3{text-align:center;color:#000;}
.container {max-width:950px;margin:20px auto;background:#fff;border-radius:10px;border:2px solid #000;box-shadow:0 0 10px #000;padding:20px;}
label{display:block;font-weight:bold;margin-top:10px;}
input,textarea{width:96%;padding:6px;border-radius:5px;border:1px solid #000;margin-top:4px;font-family:inherit;}
textarea{min-height:60px;}
.btn{background:#000;color:#fff;padding:8px 14px;margin:5px;border:none;border-radius:5px;cursor:pointer;font-weight:bold;}
.btn:hover{background:#333;}
.section{border:2px solid #000;border-radius:8px;margin-top:15px;padding:10px;background:#f9f9f9;}
.output{border:2px solid #000;border-radius:8px;margin-top:15px;padding:10px;background:#fff;color:#000;display:none;}
.hidden{display:none;}
@media(max-width:600px){.container{padding:10px}input,textarea{width:100%;}}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ›‹ Matiani | Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´ Ù…Ø¨Ù„ Ùˆ ØµÙ†Ø¯Ù„ÛŒ</h1>

<label>Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ</label><input id="customer">
<label>Ù…Ø¯Ù„</label><input id="model">
<label>ØªØ§Ø±ÛŒØ® ØªØ­ÙˆÛŒÙ„ (YYYY-MM-DD)</label><input id="delDate" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹ 1403-12-20">
<label>ØªØµÙˆÛŒØ± Ù…Ø¯Ù„ Ù…Ø¨Ù„</label><input id="modelImg" type="file" accept="image/*">

<div class="section" id="paintSection">
<h3>Û±. Ø±Ù†Ú¯â€ŒÚ©Ø§Ø±ÛŒ</h3>
<div class="paint-item"><input placeholder="Ø±Ù†Ú¯ Ú©Ø§Ø±" class="paintColor"><input placeholder="Ù†ÙˆØ¹ Ù¾ÙˆØ´Ø´ ÛŒØ§ Ù„Ø§Ú©" class="paintFinish"><textarea placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø±Ù†Ú¯â€ŒÚ©Ø§Ø±ÛŒ" class="paintNote"></textarea></div>
<button class="btn" onclick="addField('paint')">â•</button>
</div>

<div class="section" id="fabSection">
<h3>Û². Ø®ÛŒØ§Ø·ÛŒ</h3>
<div class="fab-item"><input placeholder="Ú©Ø¯ Ù¾Ø§Ø±Ú†Ù‡" class="fabCode"><input placeholder="Ø±Ù†Ú¯ Ù¾Ø§Ø±Ú†Ù‡" class="fabColor"><textarea placeholder="Ø´Ø±Ø­ ØªÙØµÛŒÙ„ÛŒ Ù¾Ø§Ø±Ú†Ù‡ØŒ Ú©ÙˆØ³Ù† Ùˆ Ù…ÙˆØ§Ø±Ø¯ Ø¯ÛŒÚ¯Ø±..." class="fabNote"></textarea></div>
<button class="btn" onclick="addField('fab')">â•</button>
</div>

<div class="section" id="carpSection">
<h3>Û³. Ù†Ø¬Ø§Ø±ÛŒ</h3>
<div class="carp-item"><input placeholder="Ù…Ø¯Ù„ Ù…Ø¨Ù„" class="carpModel"><textarea placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©Ø§Ø± Ù†Ø¬Ø§Ø±ÛŒ" class="carpNote"></textarea></div>
<button class="btn" onclick="addField('carp')">â•</button>
</div>

<div class="section" id="upSection">
<h3>Û´. Ø±ÙˆÛŒâ€ŒÚ©ÙˆØ¨ÛŒ</h3>
<div class="up-item"><textarea placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø±ÙˆÛŒâ€ŒÚ©ÙˆØ¨ÛŒ" class="upNote"></textarea></div>
<button class="btn" onclick="addField('up')">â•</button>
</div>

<div class="section">
<h3>Ûµ. ØªØ­ÙˆÛŒÙ„ Ú©Ø§Ù„Ø§</h3>
<textarea placeholder="Ø¢Ø¯Ø±Ø³ Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª ØªØ­ÙˆÛŒÙ„" id="delNote"></textarea>
</div>

<button class="btn" onclick="saveOrder()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø³ÙØ§Ø±Ø´</button>
<button class="btn" onclick="toggleOrders()">ğŸ“‹ Ù†Ù…Ø§ÛŒØ´ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</button>

<div id="orderList" class="section hidden"></div>
<div id="output" class="output"></div>
</div>

<script>
const BACKEND_URL='https://YOUR_VERCEL_APP/api/saveOrder'; // Ø¨Ø¹Ø¯ Ø§Ø² Ø¯ÛŒÙ¾Ù„ÙˆÛŒ Vercel Ø§ÛŒÙ† URL Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†
let orders = [];

async function loadOrders(){
  try{
    const res = await fetch(BACKEND_URL);
    if(res.ok){ orders = await res.json(); localStorage.setItem('orders',JSON.stringify(orders)); return; }
  }catch{}
  orders = JSON.parse(localStorage.getItem("orders")||"[]");
}
loadOrders();

function addField(type){
  const section=document.getElementById(type+'Section');
  let html='';
  if(type==='paint') html=`<div class='paint-item'><input placeholder='Ø±Ù†Ú¯ Ú©Ø§Ø±' class='paintColor'><input placeholder='Ù†ÙˆØ¹ Ù¾ÙˆØ´Ø´ ÛŒØ§ Ù„Ø§Ú©' class='paintFinish'><textarea placeholder='ØªÙˆØ¶ÛŒØ­Ø§Øª Ø±Ù†Ú¯â€ŒÚ©Ø§Ø±ÛŒ' class='paintNote'></textarea></div>`;
  if(type==='fab') html=`<div class='fab-item'><input placeholder='Ú©Ø¯ Ù¾Ø§Ø±Ú†Ù‡' class='fabCode'><input placeholder='Ø±Ù†Ú¯ Ù¾Ø§Ø±Ú†Ù‡' class='fabColor'><textarea placeholder='Ø´Ø±Ø­ ØªÙØµÛŒÙ„ÛŒ Ù¾Ø§Ø±Ú†Ù‡ØŒ Ú©ÙˆØ³Ù†...' class='fabNote'></textarea></div>`;
  if(type==='carp') html=`<div class='carp-item'><input placeholder='Ù…Ø¯Ù„ Ù…Ø¨Ù„' class='carpModel'><textarea placeholder='ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©Ø§Ø± Ù†Ø¬Ø§Ø±ÛŒ' class='carpNote'></textarea></div>`;
  if(type==='up') html=`<div class='up-item'><textarea placeholder='ØªÙˆØ¶ÛŒØ­Ø§Øª Ø±ÙˆÛŒâ€ŒÚ©ÙˆØ¨ÛŒ' class='upNote'></textarea></div>`;
  section.insertAdjacentHTML('beforeend',html);
}

function collect(selector,fields){
  return [...document.querySelectorAll(selector)].map(div=>{
    let obj={};
    fields.forEach(f=>{const el=div.querySelector('.'+f); if(el) obj[f]=el.value.trim();});
    return obj;
  });
}

function val(id){return document.getElementById(id).value.trim();}

async function saveOrder(){
  const order={
    customer:val('customer'),
    model:val('model'),
    delDate:val('delDate'),
    delNote:val('delNote'),
    paint:collect('.paint-item',['paintColor','paintFinish','paintNote']),
    fab:collect('.fab-item',['fabCode','fabColor','fabNote']),
    carp:collect('.carp-item',['carpModel','carpNote']),
    up:collect('.up-item',['upNote'])
  };
  orders.push(order);
  localStorage.setItem('orders',JSON.stringify(orders));
  clearForm();
  await pushToGithub(order);
  renderOrders();
  alert('âœ… Ø³ÙØ§Ø±Ø´ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
}

function clearForm(){
  document.querySelectorAll('input,textarea').forEach(el=>{if(el.type!=='file')el.value='';});
  document.getElementById('customer').focus();
}

function toggleOrders(){document.getElementById('orderList').classList.toggle('hidden'); renderOrders();}

function renderOrders(){
  const listDiv=document.getElementById('orderList');
  if(orders.length===0){listDiv.innerHTML='<p>Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>';return;}
  listDiv.innerHTML=orders.map((o,i)=>`<div style='border:1px solid #000;padding:8px;margin-bottom:8px;'><b>${o.customer}</b> | Ù…Ø¯Ù„: ${o.model} | ØªØ§Ø±ÛŒØ® ØªØ­ÙˆÛŒÙ„: ${o.delDate}<br><div style='margin-top:6px;'><button class='btn' onclick="showSection(${i},'summary')">ğŸ“„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¨Ø±Ú¯Ù‡ ØªØ­ÙˆÛŒÙ„ Ú©Ø§Ù„Ø§</button></div></div>`).join('');
}

function formatArray(arr){return arr.map(a=>Object.values(a).filter(Boolean).join(' | ')).join('<hr>');}

function showSection(i,type){
  const o=orders[i];let html='';
  html+=`<h3>Ø¨Ø±Ú¯Ù‡ ØªØ­ÙˆÛŒÙ„ Ú©Ø§Ù„Ø§</h3><table style='width:100%;border-collapse:collapse;border:1px solid #000;'>`;
  html+=`<tr><th>Ù…Ø´ØªØ±ÛŒ</th><td>${o.customer}</td></tr>`;
  html+=`<tr><th>Ù…Ø¯Ù„</th><td>${o.model}</td></tr>`;
  html+=`<tr><th>ØªØ§Ø±ÛŒØ® ØªØ­ÙˆÛŒÙ„</th><td>${o.delDate}</td></tr>`;
  html+=`<tr><th>Ø±Ù†Ú¯â€ŒÚ©Ø§Ø±ÛŒ</th><td>${formatArray(o.paint)}</td></tr>`;
  html+=`<tr><th>Ø®ÛŒØ§Ø·ÛŒ</th><td>${formatArray(o.fab)}</td></tr>`;
  html+=`<tr><th>Ù†Ø¬Ø§Ø±ÛŒ</th><td>${formatArray(o.carp)}</td></tr>`;
  html+=`<tr><th>Ø±ÙˆÛŒâ€ŒÚ©ÙˆØ¨ÛŒ</th><td>${formatArray(o.up)}</td></tr>`;
  html+=`<tr><th>ØªÙˆØ¶ÛŒØ­Ø§Øª ØªØ­ÙˆÛŒÙ„</th><td>${o.delNote}</td></tr></table>`;
  const out=document.getElementById('output');
  out.innerHTML=`<h2>${o.customer} | Ù…Ø¯Ù„ ${o.model}</h2>${html}<div style='text-align:center;margin-top:8px;'><button class='btn' onclick='printSection()'>ğŸ–¨ Ú†Ø§Ù¾</button></div>`;
  out.style.display='block';window.scrollTo(0,document.body.scrollHeight);
}

function printSection(){const content=document.getElementById('output').innerHTML;const newWin=window.open('','_blank');newWin.document.write('<html><head><title>Ú†Ø§Ù¾</title></head><body>'+content+'</body></html>');newWin.document.close();newWin.print();}

async function pushToGithub(order){
  try{
    const res=await fetch(BACKEND_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(order)});
    const data=await res.json();
    if(data.ok){orders=data.orders; localStorage.setItem('orders',JSON.stringify(orders)); renderOrders(); return true;}
    else return false;
  }catch(e){console.warn('pushToGithub failed',e); return false;}
}
</script>
</body>
</html>
