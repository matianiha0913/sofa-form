<!DOCTYPE html><html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´ Matiani</title>
<style>
@font-face { font-family: 'IranSans'; src: local('IranSans'), url('fonts/IRANSans.ttf') format('truetype'); }
body{font-family:'IranSans', Tahoma, sans-serif; background:#fff; color:#000; margin:0; padding:0}
.header{max-width:950px;margin:18px auto;text-align:center}
.brand{font-weight:900;font-size:20px;border:2px solid #000;padding:8px 12px;border-radius:8px;display:inline-block}
.container{max-width:950px;margin:8px auto;background:#fff;border-radius:10px;border:2px solid #000;padding:18px}
h1,h2{margin:6px 0;text-align:center}
.form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.label{display:block;margin-bottom:6px;font-weight:700}
.input, textarea, select{width:100%;padding:8px;border-radius:6px;border:1px solid #000;font-family:inherit}
textarea{min-height:70px}
.row{display:flex;gap:12px}
.btn{background:#000;color:#fff;padding:10px 14px;margin:6px;border:none;border-radius:6px;cursor:pointer;font-weight:700}
.btn:hover{opacity:0.9}
.section{border:1px solid #000;border-radius:8px;padding:10px;background:#fafafa;margin-top:12px}
.order-card{border:1px solid #000;padding:10px;margin-bottom:8px;border-radius:8px}
.order-actions{margin-top:8px;display:flex;gap:6px;flex-wrap:wrap}
.hidden{display:none}
.output-area{border:1px solid #000;border-radius:8px;padding:10px;margin-top:12px;background:#fff}
.thumb{max-width:120px;max-height:80px;border:1px solid #000;padding:4px;border-radius:6px}
@media (max-width:700px){.form-grid{grid-template-columns:1fr}.row{flex-direction:column}}
</style>
</head>
<body><div class="header">
  <div class="brand">Matiani</div>
  <h1>ğŸ›‹ Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´ Matiani</h1>
  <p style="margin:6px 0;color:#333">ÙØ§Ø±Ø³ÛŒ: Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ùˆ Ø§Ø´ØªØ±Ø§Ú© Ø³ÙØ§Ø±Ø´ Ù…Ø¨Ù„ Ùˆ ØµÙ†Ø¯Ù„ÛŒ â€” Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨ÛŒÙ† Ú†Ù†Ø¯ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¨Ø§ Firebase</p>
</div><div class="container">
  <div id="form">
    <div class="form-grid">
      <div>
        <label class="label">Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ</label>
        <input class="input" id="customer" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
      </div><div>
    <label class="label">Ù…Ø¯Ù„</label>
    <input class="input" id="model" placeholder="Ù…Ø«Ù„Ø§Ù‹ 3 Ù†ÙØ±Ù‡ Ù…Ø¯Ù„ Ø¢Ø±Ø§Ù…">
  </div>

  <div>
    <label class="label">ØªØ§Ø±ÛŒØ® ØªØ­ÙˆÛŒÙ„ (Ù‚Ø§Ø¨Ù„ ØªØ§ÛŒÙ¾: YYYY-MM-DD)</label>
    <input class="input" id="delDate" placeholder="2025-12-31" pattern="\d{4}-\d{2}-\d{2}">
  </div>

  <div>
    <label class="label">ØªØµÙˆÛŒØ± Ù…Ø¯Ù„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
    <input class="input" id="imageFile" type="file" accept="image/*">
  </div>
</div>

<div class="section">
  <h3>Û±. Ø±Ù†Ú¯â€ŒÚ©Ø§Ø±ÛŒ</h3>
  <input class="input" id="paintColor" placeholder="Ø±Ù†Ú¯ Ú©Ø§Ø±">
  <input class="input" id="paintFinish" placeholder="Ù†ÙˆØ¹ Ù¾ÙˆØ´Ø´ ÛŒØ§ Ù„Ø§Ú©">
  <input class="input" id="paintCount" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ù‚Ø·Ø¹Ø§Øª">
  <textarea id="paintNote" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø±Ù†Ú¯â€ŒÚ©Ø§Ø±ÛŒ"></textarea>
</div>

<div class="section">
  <h3>Û². Ø®ÛŒØ§Ø·ÛŒ</h3>
  <input class="input" id="fabCode" placeholder="Ú©Ø¯ Ù¾Ø§Ø±Ú†Ù‡">
  <input class="input" id="fabColor" placeholder="Ø±Ù†Ú¯ Ù¾Ø§Ø±Ú†Ù‡">
  <textarea id="fabNote" placeholder="Ø´Ø±Ø­ ØªÙØµÛŒÙ„ÛŒ Ù¾Ø§Ø±Ú†Ù‡ØŒ Ú©ÙˆØ³Ù† Ùˆ Ù…ÙˆØ§Ø±Ø¯ Ø¯ÛŒÚ¯Ø±..."></textarea>
</div>

<div class="section">
  <h3>Û³. Ù†Ø¬Ø§Ø±ÛŒ</h3>
  <input class="input" id="carpModel" placeholder="Ù…Ø¯Ù„ Ù…Ø¨Ù„ ÛŒØ§ Ø¬Ø²Ø¦ÛŒØ§Øª Ù†Ø¬Ø§Ø±ÛŒ">
  <textarea id="carpNote" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©Ø§Ø± Ù†Ø¬Ø§Ø±ÛŒ (Ù…Ø«Ù„Ø§Ù‹ Ù†ÙˆØ¹ Ø§ØªØµØ§Ù„ØŒ Ù¾Ø§ÛŒÙ‡ØŒ Ø³Ø§Ø®ØªØ§Ø±...)"></textarea>
</div>

<div class="section">
  <h3>Û´. Ø±ÙˆÛŒâ€ŒÚ©ÙˆØ¨ÛŒ</h3>
  <textarea id="upNote" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø±ÙˆÛŒâ€ŒÚ©ÙˆØ¨ÛŒ (Ù†ÙˆØ¹ ÙÙˆÙ…ØŒ Ø§Ø¨Ø±ØŒ Ù¾Ø§Ø±Ú†Ù‡ Ø±ÙˆØ¨Ø§Ù†...)"></textarea>
</div>

<div class="section">
  <h3>Ûµ. ØªØ­ÙˆÛŒÙ„ Ú©Ø§Ù„Ø§</h3>
  <textarea id="delNote" placeholder="Ø¢Ø¯Ø±Ø³ Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª ØªØ­ÙˆÛŒÙ„ Ú©Ø§Ù„Ø§"></textarea>
</div>

<div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
  <button class="btn" id="saveBtn">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø³ÙØ§Ø±Ø´</button>
  <button class="btn" id="toggleBtn">ğŸ“‹ Ù†Ù…Ø§ÛŒØ´ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</button>
  <button class="btn" id="clearLocal">ğŸ—‘ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù…Ø­Ù„ÛŒ</button>
</div>

  </div>  <div id="orderList" class="section hidden"></div>
  <div id="output" class="output-area hidden"></div>
</div><script>
/*
  ÙØ§ÛŒÙ„ Ø­Ø§Ø¶Ø±:
  - Ø·Ø±Ø§Ø­ÛŒ ÙØ±Ù… Ù…Ø±ØªØ¨ (Ø¯Ùˆ Ø³ØªÙˆÙ†)
  - Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ùˆ Ù‚Ø§Ø¨â€ŒÙ‡Ø§ Ù…Ø´Ú©ÛŒ
  - Ø­Ø°Ù ÙÛŒÙ„Ø¯ Ù‚ÛŒÙ…Øª Ùˆ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† ØªØ§Ø±ÛŒØ® Ù‚Ø§Ø¨Ù„ ØªØ§ÛŒÙ¾
  - Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± Ù…Ø¯Ù„ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
  - Ø®Ø±ÙˆØ¬ÛŒ Ú†Ø§Ù¾ ÙÙ‚Ø· Ù‡Ù…Ø§Ù† Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø±Ø§ Ú†Ø§Ù¾ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
  - Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Firebase Realtime Database Ùˆ Storage (Ø¯Ø± ØµÙˆØ±Øª Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† ØªÙ†Ø¸ÛŒÙ…Ø§Øª)

  Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Firebase: Ø¯Ø± Ú©Ø¯ Ø²ÛŒØ± Ù…Ù‚Ø¯Ø§Ø± firebaseConfig Ø±Ø§ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡Ù” Ø®ÙˆØ¯ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯.
  Ø§Ú¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆØ§Ø±Ø¯ Ù†Ø´ÙˆØ¯ØŒ Ø³ÛŒØ³ØªÙ… ÙÙ‚Ø· Ø¨Ø§ localStorage Ú©Ø§Ø± Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯.
*/

// ------------- Firebase setup (put your config here) ------------------
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "...",
  appId: "..."
};

let USE_FIREBASE = false;
let firebaseApp, database, storage;

function tryInitFirebase(){
  try{
    if(!firebaseConfig || !firebaseConfig.apiKey || firebaseConfig.apiKey.startsWith('YOUR')){
      console.warn('Firebase config missing or placeholder â€” running in local-only mode');
      return;
    }
    // load sdk scripts dynamically
    const script1 = document.createElement('script');
    script1.src = 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js';
    script1.onload = ()=>{
      const s2 = document.createElement('script');
      s2.src = 'https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js';
      s2.onload = ()=>{
        const s3 = document.createElement('script');
        s3.src = 'https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js';
        s3.onload = initFirebase;
        document.head.appendChild(s3);
      }
      document.head.appendChild(s2);
    }
    document.head.appendChild(script1);
  }catch(e){console.error('firebase init error',e)}
}

function initFirebase(){
  try{
    firebaseApp = firebase.initializeApp(firebaseConfig);
    database = firebase.database();
    storage = firebase.storage();
    USE_FIREBASE = true;
    console.log('Firebase initialized â€” realtime sync enabled');
    startRealtimeListener();
  }catch(e){console.error('init firebase failed',e)}
}

tryInitFirebase();

// ---------------- local storage fallback ----------------
let orders = JSON.parse(localStorage.getItem('orders') || '[]');

function saveToLocal(){ localStorage.setItem('orders', JSON.stringify(orders)); }

// ----------------- utility -----------------
function $(id){return document.getElementById(id)}
function val(id){return $(id).value.trim()}
function clearForm(){ Array.from(document.querySelectorAll('input[type!=file], textarea')).forEach(i=>i.value=''); $('imageFile').value=''; }

// ----------------- image upload -----------------
async function uploadImage(file, pathPrefix='orders'){
  if(!file) return null;
  if(!USE_FIREBASE){
    // create local object URL and return it â€” note: not persistent across devices
    return URL.createObjectURL(file);
  }
  const filename = Date.now() + '_' + file.name.replace(/[^a-zA-Z0-9\.\-_]/g,'');
  const ref = storage.ref().child(pathPrefix + '/' + filename);
  const snap = await ref.put(file);
  const url = await snap.ref.getDownloadURL();
  return url;
}

// ----------------- save order -----------------
async function saveOrder(){
  const fileInput = $('imageFile');
  const file = fileInput.files && fileInput.files[0] ? fileInput.files[0] : null;

  // basic validation
  if(!val('customer')){ alert('Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return }
  if(!val('model')){ alert('Ù…Ø¯Ù„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); return }
  // delDate is free text but we recommend YYYY-MM-DD. No hard validation to allow flexibility.

  const imgUrl = await uploadImage(file);

  const order = {
    id: 'o_' + Date.now(),
    customer: val('customer'),
    model: val('model'),
    delDate: val('delDate'),
    image: imgUrl || '',
    paintColor: val('paintColor'),
    paintFinish: val('paintFinish'),
    paintCount: val('paintCount'),
    paintNote: val('paintNote'),
    fabCode: val('fabCode'),
    fabColor: val('fabColor'),
    fabNote: val('fabNote'),
    carpModel: val('carpModel'),
    carpNote: val('carpNote'),
    upNote: val('upNote'),
    delNote: val('delNote'),
    createdAt: Date.now()
  };

  orders.push(order);
  saveToLocal();

  if(USE_FIREBASE){
    // write to realtime db under /orders/{id}
    try{
      database.ref('orders/' + order.id).set(order);
    }catch(e){console.error('firebase write err', e)}
  }

  clearForm();
  renderOrders();
  alert('âœ… Ø³ÙØ§Ø±Ø´ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
}

// ----------------- realtime listener -----------------
function startRealtimeListener(){
  if(!USE_FIREBASE) return;
  const ref = database.ref('orders');
  ref.on('value', snapshot => {
    const val = snapshot.val();
    if(!val) return;
    // merge remote orders with local orders (avoid duplicates)
    const remote = Object.values(val || {});
    const merged = {};
    orders.concat(remote).forEach(o=>{ merged[o.id] = o; });
    orders = Object.values(merged).sort((a,b)=>b.createdAt - a.createdAt);
    saveToLocal();
    renderOrders();
  });
}

// ----------------- render -----------------
function toggleOrders(){
  const listDiv = $('orderList');
  listDiv.classList.toggle('hidden');
  renderOrders();
}

function renderOrders(){
  const listDiv = $('orderList');
  if(orders.length === 0){ listDiv.innerHTML = '<p>Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>'; return }
  listDiv.innerHTML = orders.map((o,i)=>{
    const imgHtml = o.image ? `<img class=\"thumb\" src=\"${o.image}\" alt=\"thumb\">` : '';
    return `
    <div class=\"order-card\"> 
      <div><b>${o.customer}</b> | Ù…Ø¯Ù„: ${o.model} | ØªØ§Ø±ÛŒØ® ØªØ­ÙˆÛŒÙ„: ${o.delDate}</div>
      <div style=\"margin-top:8px;\">${imgHtml}</div>
      <div class=\"order-actions\">
        <button class=\"btn\" onclick=\"showSection(${i},'paint')\">ğŸ¨ Ø±Ù†Ú¯â€ŒÚ©Ø§Ø±ÛŒ</button>
        <button class=\"btn\" onclick=\"showSection(${i},'fab')\">ğŸ§µ Ø®ÛŒØ§Ø·ÛŒ</button>
        <button class=\"btn\" onclick=\"showSection(${i},'carp')\">ğŸª“ Ù†Ø¬Ø§Ø±ÛŒ</button>
        <button class=\"btn\" onclick=\"showSection(${i},'up')\">ğŸ›  Ø±ÙˆÛŒâ€ŒÚ©ÙˆØ¨ÛŒ</button>
        <button class=\"btn\" onclick=\"showSection(${i},'del')\">ğŸšš ØªØ­ÙˆÛŒÙ„ Ú©Ø§Ù„Ø§</button>
        <button class=\"btn\" onclick=\"shareWhatsApp(${i})\">ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ù¾</button>
      </div>
    </div>`
  }).join('');
}

// ----------------- show section & print only that section -----------------
function showSection(i,type){
  const o = orders[i];
  let html = '';
  if(type==='paint') html = `\n  <h2>Ø¨Ø±Ú¯Ù‡ Ø±Ù†Ú¯â€ŒÚ©Ø§Ø±ÛŒ â€” ${o.customer} | ${o.model}</h2>\n  <table>\n  <tr><th>Ø±Ù†Ú¯</th><td>${o.paintColor}</td></tr>\n  <tr><th>Ù¾ÙˆØ´Ø´</th><td>${o.paintFinish}</td></tr>\n  <tr><th>ØªØ¹Ø¯Ø§Ø¯ Ù‚Ø·Ø¹Ø§Øª</th><td>${o.paintCount}</td></tr>\n  <tr><th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th><td>${o.paintNote}</td></tr>\n  </table>`;
  if(type==='fab') html = `\n  <h2>Ø¨Ø±Ú¯Ù‡ Ø®ÛŒØ§Ø·ÛŒ â€” ${o.customer} | ${o.model}</h2>\n  <table>\n  <tr><th>Ú©Ø¯ Ù¾Ø§Ø±Ú†Ù‡</th><td>${o.fabCode}</td></tr>\n  <tr><th>Ø±Ù†Ú¯ Ù¾Ø§Ø±Ú†Ù‡</th><td>${o.fabColor}</td></tr>\n  <tr><th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th><td>${o.fabNote}</td></tr>\n  </table>`;
  if(type==='carp') html = `\n  <h2>Ø¨Ø±Ú¯Ù‡ Ù†Ø¬Ø§Ø±ÛŒ â€” ${o.customer} | ${o.model}</h2>\n  <table>\n  <tr><th>Ù…Ø¯Ù„</th><td>${o.carpModel}</td></tr>\n  <tr><th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th><td>${o.carpNote}</td></tr>\n  </table>`;
  if(type==='up') html = `\n  <h2>Ø¨Ø±Ú¯Ù‡ Ø±ÙˆÛŒâ€ŒÚ©ÙˆØ¨ÛŒ â€” ${o.customer} | ${o.model}</h2>\n  <table>\n  <tr><th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th><td>${o.upNote}</td></tr>\n  </table>`;
  if(type==='del') html = `\n  <h2>Ø¨Ø±Ú¯Ù‡ ØªØ­ÙˆÛŒÙ„ Ú©Ø§Ù„Ø§ â€” ${o.customer} | ${o.model}</h2>\n  <table>\n  <tr><th>Ù…Ø´ØªØ±ÛŒ</th><td>${o.customer}</td></tr>\n  <tr><th>Ù…Ø¯Ù„</th><td>${o.model}</td></tr>\n  <tr><th>ØªØ§Ø±ÛŒØ® ØªØ­ÙˆÛŒÙ„</th><td>${o.delDate}</td></tr>\n  <tr><th>Ø¢Ø¯Ø±Ø³/ØªÙˆØ¶ÛŒØ­Ø§Øª ØªØ­ÙˆÛŒÙ„</th><td>${o.delNote}</td></tr>\n  <tr><th>Ø±Ù†Ú¯â€ŒÚ©Ø§Ø±ÛŒ</th><td>${o.paintColor} â€” ${o.paintFinish} â€” ${o.paintNote}</td></tr>\n  <tr><th>Ø®ÛŒØ§Ø·ÛŒ</th><td>${o.fabCode} â€” ${o.fabColor} â€” ${o.fabNote}</td></tr>\n  <tr><th>Ù†Ø¬Ø§Ø±ÛŒ</th><td>${o.carpModel} â€” ${o.carpNote}</td></tr>\n  <tr><th>Ø±ÙˆÛŒâ€ŒÚ©ÙˆØ¨ÛŒ</th><td>${o.upNote}</td></tr>\n  </table>`;

  if(o.image) html += `\n  <div style=\"margin-top:8px;\">\n    <img src=\"${o.image}\" style=\"max-width:320px;max-height:240px;border:1px solid #000;padding:6px;border-radius:6px\">\n  </div>`;

  const out = $('output');
  out.innerHTML = html + `\n  <div style=\"text-align:center;margin-top:8px;\">\n    <button class='btn' onclick='printSection(${i},"${type}")'>ğŸ–¨ Ú†Ø§Ù¾</button>\n    <button class='btn' onclick='closeOutput()'>âœ– Ø¨Ø³ØªÙ†</button>\n  </div>`;
  out.classList.remove('hidden');
  window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
}

function closeOutput(){ $('output').classList.add('hidden'); }

function printSection(i,type){
  const o = orders[i];
  // build a minimal HTML page with just the section we want
  let content = '';
  if(type==='paint') content = `<h2>Ø¨Ø±Ú¯Ù‡ Ø±Ù†Ú¯â€ŒÚ©Ø§Ø±ÛŒ â€” ${o.customer} | ${o.model}</h2>` +
    `<p><b>Ø±Ù†Ú¯:</b> ${o.paintColor}</p><p><b>Ù¾ÙˆØ´Ø´:</b> ${o.paintFinish}</p><p><b>ØªØ¹Ø¯Ø§Ø¯:</b> ${o.paintCount}</p><p><b>ØªÙˆØ¶ÛŒØ­Ø§Øª:</b> ${o.paintNote}</p>`;
  if(type==='fab') content = `<h2>Ø¨Ø±Ú¯Ù‡ Ø®ÛŒØ§Ø·ÛŒ â€” ${o.customer} | ${o.model}</h2>` +
    `<p><b>Ú©Ø¯ Ù¾Ø§Ø±Ú†Ù‡:</b> ${o.fabCode}</p><p><b>Ø±Ù†Ú¯ Ù¾Ø§Ø±Ú†Ù‡:</b> ${o.fabColor}</p><p><b>ØªÙˆØ¶ÛŒØ­Ø§Øª:</b> ${o.fabNote}</p>`;
  if(type==='carp') content = `<h2>Ø¨Ø±Ú¯Ù‡ Ù†Ø¬Ø§Ø±ÛŒ â€” ${o.customer} | ${o.model}</h2>` +
    `<p><b>Ù…Ø¯Ù„:</b> ${o.carpModel}</p><p><b>ØªÙˆØ¶ÛŒØ­Ø§Øª:</b> ${o.carpNote}</p>`;
  if(type==='up') content = `<h2>Ø¨Ø±Ú¯Ù‡ Ø±ÙˆÛŒâ€ŒÚ©ÙˆØ¨ÛŒ â€” ${o.customer} | ${o.model}</h2>` +
    `<p><b>ØªÙˆØ¶ÛŒØ­Ø§Øª:</b> ${o.upNote}</p>`;
  if(type==='del') content = `<h2>Ø¨Ø±Ú¯Ù‡ ØªØ­ÙˆÛŒÙ„ Ú©Ø§Ù„Ø§ â€” ${o.customer} | ${o.model}</h2>` +
    `<p><b>ØªØ§Ø±ÛŒØ® ØªØ­ÙˆÛŒÙ„:</b> ${o.delDate}</p><p><b>Ø¢Ø¯Ø±Ø³:</b> ${o.delNote}</p>` +
    `<hr><p><b>Ø¬Ù…Ø¹ ØªÙˆØ¶ÛŒØ­Ø§Øª:</b></p><p>Ø±Ù†Ú¯â€ŒÚ©Ø§Ø±ÛŒ: ${o.paintColor} â€” ${o.paintFinish} â€” ${o.paintNote}</p>` +
    `<p>Ø®ÛŒØ§Ø·ÛŒ: ${o.fabCode} â€” ${o.fabColor} â€” ${o.fabNote}</p>` +
    `<p>Ù†Ø¬Ø§Ø±ÛŒ: ${o.carpModel} â€” ${o.carpNote}</p>` +
    `<p>Ø±ÙˆÛŒâ€ŒÚ©ÙˆØ¨ÛŒ: ${o.upNote}</p>`;

  if(o.image) content += `<div style=\"margin-top:10px\"><img src=\"${o.image}\" style=\"max-width:560px;max-height:420px;border:1px solid #000;padding:6px;border-radius:6px\"></div>`;

  const win = window.open('','_blank');
  win.document.write('<!doctype html><html lang="fa" dir="rtl"><head><meta charset="utf-8"><title>Ú†Ø§Ù¾</title>');
  win.document.write('<style>body{font-family:Tahoma, Arial, Helvetica;direction:rtl;padding:16px;color:#000}h2{margin-bottom:6px}table{border-collapse:collapse}td,th{padding:6px;border:1px solid #000}</style>');win.document.write('</head><body>'); win.document.write('<div style="border:2px solid #000;padding:12px;border-radius:8px">'); win.document.write('<div style="text-align:center;margin-bottom:8px;font-weight:800">Matiani</div>'); win.document.write(content); win.document.write('</div></body></html>'); win.document.close(); win.focus(); setTimeout(()=>{ win.print(); win.close(); },500); }

function shareWhatsApp(i){ const o = orders[i]; const text = encodeURIComponent(Ø³ÙØ§Ø±Ø´: ${o.customer} | Ù…Ø¯Ù„: ${o.model} | ØªØ­ÙˆÛŒÙ„: ${o.delDate}); window.open(https://wa.me/?text=${text},'_blank'); }

// ----------------- wire buttons ----------------- $('saveBtn').addEventListener('click', ()=>{ saveOrder(); }); $('toggleBtn').addEventListener('click', ()=>{ toggleOrders(); }); $('clearLocal').addEventListener('click', ()=>{ if(confirm('Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù…Ø­Ù„ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯ØŸ Ø§ÛŒÙ† ÙÙ‚Ø· localStorage Ø±Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯.')){ localStorage.removeItem('orders'); orders=[]; renderOrders(); alert('localStorage Ù¾Ø§Ú© Ø´Ø¯') }});

// ----------------- initialize ----------------- renderOrders();

// If Firebase is already initialized by user action elsewhere, start listener too. if(window.firebase && window.firebase.apps && window.firebase.apps.length>0){ initFirebase(); }

</script>
</body>
</html>
